2025-11-12 03:13:09,087 - INFO - __main__ 158 - Script iniciado directamente.
2025-11-12 03:13:09,087 - INFO - __main__ 46 - Inicio de ejecucion.
2025-11-12 03:13:09,087 - INFO - __main__ 48 - N√∫mero de trials por estudio: 20
2025-11-12 03:13:12,567 - INFO - __main__ 66 - Archivo de features encontrado: gs://guijomter_bukito3/Compe_02/data/df_fe_Compe_02_V1_1z.parquet. Cargando desde GCS.
2025-11-12 03:13:12,567 - INFO - src.bucket_utils_p 86 - Descargando de GCS: gs://guijomter_bukito3/Compe_02/data/df_fe_Compe_02_V1_1z.parquet
2025-11-12 03:14:10,168 - INFO - src.bucket_utils_p 90 - Descargado en: /tmp/df_fe_Compe_02_V1_1z.parquet
2025-11-12 03:14:17,237 - INFO - src.bucket_utils_p 94 - DataFrame cargado en memoria.
2025-11-12 03:14:17,237 - INFO - src.bucket_utils_p 101 - Archivo temporal /tmp/df_fe_Compe_02_V1_1z.parquet eliminado.
2025-11-12 03:14:17,237 - INFO - __main__ 89 - Feature Engineering completado: (4717958, 543)
2025-11-12 03:14:17,237 - INFO - src.optimization_p 600 - Iniciando optimizaci√≥n con 20 trials
2025-11-12 03:14:17,237 - INFO - src.optimization_p 601 - Configuraci√≥n: TRAIN=['201901', '201902', '201903', '201904', '201905', '201906', '201907', '201908', '201909', '201910', '201911', '201912', '202001', '202002', '202011', '202012'], VALID=202101, SEMILLA=[839071, 666557]
2025-11-12 03:14:17,443 - INFO - src.optimization_p 540 - ‚ö° Base de datos encontrada: /home/guijomter/buckets/b1/Compe_02/optuna_db/Compe_02_V1_1z.db
2025-11-12 03:14:17,443 - INFO - src.optimization_p 541 - üîÑ Cargando estudio existente: Compe_02_V1_1z
2025-11-12 03:14:21,276 - INFO - src.optimization_p 548 - ‚úÖ Estudio cargado exitosamente
2025-11-12 03:14:21,276 - INFO - src.optimization_p 549 - üìä Trials previos: 20
2025-11-12 03:14:22,262 - INFO - src.optimization_p 552 - üèÜ Mejor ganancia hasta ahora: 235,505,165
2025-11-12 03:14:22,490 - INFO - src.optimization_p 611 - üîÑ Retomando desde trial 20
2025-11-12 03:14:22,491 - INFO - src.optimization_p 612 - üìù Trials a ejecutar: 0 (total objetivo: 20)
2025-11-12 03:14:22,491 - INFO - src.optimization_p 623 - ‚úÖ Ya se completaron 20 trials
2025-11-12 03:14:22,491 - INFO - __main__ 96 - === AN√ÅLISIS DE RESULTADOS ===
2025-11-12 03:14:23,158 - INFO - __main__ 100 - Top 5 mejores trials:
2025-11-12 03:14:23,158 - INFO - __main__ 102 -   Trial 5: 235,505,165
2025-11-12 03:14:23,159 - INFO - __main__ 102 -   Trial 6: 232,760,320
2025-11-12 03:14:23,159 - INFO - __main__ 102 -   Trial 18: 232,271,808
2025-11-12 03:14:23,159 - INFO - __main__ 102 -   Trial 8: 231,406,913
2025-11-12 03:14:23,159 - INFO - __main__ 102 -   Trial 9: 231,266,404
2025-11-12 03:14:23,159 - INFO - __main__ 104 - === OPTIMIZACI√ìN COMPLETADA ===
2025-11-12 03:14:23,159 - INFO - __main__ 107 - === EVALUACI√ìN EN CONJUNTO DE TEST ===
2025-11-12 03:14:23,160 - INFO - src.best_params 49 - Mejores hiperpar√°metros cargados desde resultados/Compe_02_V1_1z_iteraciones.json
2025-11-12 03:14:23,160 - INFO - src.best_params 50 - Mejor ganancia encontrada: 235,505,165
2025-11-12 03:14:23,160 - INFO - src.best_params 51 - Trial n√∫mero: 5
2025-11-12 03:14:23,160 - INFO - src.best_params 52 - Par√°metros: {'num_iterations': 791, 'num_leaves': 32, 'learning_rate': 0.06042022439783674, 'feature_fraction': 0.9211775896580184, 'min_child_samples': 15, 'max_depth': 6, 'reg_lambda': 8.61923640022853, 'reg_alpha': 7.350609321509172, 'min_gain_to_split': 0.5404345907464742, 'bagging_freq': 1, 'objective': 'binary', 'metric': 'None', 'random_state': 839071}
2025-11-12 03:14:23,160 - INFO - src.optimization_p 319 - === EVALUACI√ìN EN CONJUNTO DE TEST ===
2025-11-12 03:14:23,160 - INFO - src.optimization_p 320 - Per√≠odo de test: 202102
2025-11-12 03:14:29,496 - INFO - src.optimization_p 793 - Undersampling aplicado: tasa=0.03, registros originales=2341167 (C May: 2320264 / C Min: 20903), registros finales=164817 (CMay : 143914 / CMin: 20903)
2025-11-12 03:14:30,084 - INFO - src.optimization_p 336 - Entrenando modelo con mejores hiperpar√°metros...
2025-11-12 03:14:30,084 - INFO - src.optimization_p 337 - Dimensiones df_train_completo: (164817, 543), Dimensiones df_test: (162155, 543)
2025-11-12 03:14:30,269 - INFO - src.optimization_p 346 - Tipo de dato de train_data: <class 'lightgbm.basic.Dataset'>, Dimensiones de train_data: (164817, 541)
2025-11-12 03:15:14,251 - INFO - src.optimization_p 349 - Modelo final para test entrenado. Calculando ganancia en Test...
2025-11-12 03:15:17,709 - INFO - src.optimization_p 302 - Ganancia: 292,260,000---Total Predicciones positivas: 9,547
2025-11-12 03:15:17,709 - INFO - __main__ 119 - === RESUMEN DE EVALUACI√ìN EN TEST ===
2025-11-12 03:15:17,709 - INFO - __main__ 120 - ‚úÖ Ganancia en test: 292,260,000
2025-11-12 03:15:17,710 - INFO - __main__ 121 - üîç Umbral √≥ptimo encontrado: 0.5150
2025-11-12 03:15:17,710 - INFO - __main__ 122 - üéØ Predicciones positivas: 9,547 (5.89%)
2025-11-12 03:15:17,710 - INFO - __main__ 126 - === ENTRENAMIENTO FINAL ===
2025-11-12 03:15:17,710 - INFO - __main__ 127 - Preparar datos para entrenamiento final
2025-11-12 03:15:17,710 - INFO - src.final_training_p 352 - Preparando datos para entrenamiento final
2025-11-12 03:15:17,710 - INFO - src.final_training_p 353 - Per√≠odos de entrenamiento: ['201901', '201902', '201903', '201904', '201905', '201906', '201907', '201908', '201909', '201910', '201911', '201912', '202001', '202002', '202011', '202012', '202101', '202102']
2025-11-12 03:15:17,710 - INFO - src.final_training_p 354 - Per√≠odo de predicci√≥n: 202106
2025-11-12 03:15:19,153 - INFO - src.final_training_p 366 - Registros de entrenamiento: 2,503,322
2025-11-12 03:15:19,154 - INFO - src.final_training_p 367 - Registros de predicci√≥n: 164,313
2025-11-12 03:15:21,280 - INFO - src.optimization_p 793 - Undersampling aplicado: tasa=0.03, registros originales=2503322 (C May: 2480569 / C Min: 22753), registros finales=185210 (CMay : 162457 / CMin: 22753)
2025-11-12 03:15:22,291 - INFO - src.final_training_p 382 - Features utilizadas: 541
2025-11-12 03:15:22,292 - INFO - src.final_training_p 383 - Distribuci√≥n del target - 0: 162,457, 1: 22,753
2025-11-12 03:15:22,312 - INFO - __main__ 132 - Entrenar modelo final
2025-11-12 03:15:22,312 - INFO - src.final_training_p 240 - Iniciando entrenamiento del modelo final
2025-11-12 03:16:11,150 - INFO - src.final_training_p 271 - Modelo final (semilla 839071) guardado en: resultados/Compe_02_V1_1z/modelo_final_semilla_839071_2025-11-12_03-16-11.txt
2025-11-12 03:16:53,705 - INFO - src.final_training_p 271 - Modelo final (semilla 666557) guardado en: resultados/Compe_02_V1_1z/modelo_final_semilla_666557_2025-11-12_03-16-53.txt
2025-11-12 03:16:53,705 - INFO - src.final_training_p 275 - Entrenamiento de modelos finales completado
2025-11-12 03:16:53,706 - INFO - __main__ 136 - Generar predicciones finales
2025-11-12 03:16:53,707 - INFO - src.final_training_p 294 - Generando predicciones finales (promedio de seeds)
2025-11-12 03:17:00,350 - INFO - src.final_training_p 313 - Predicciones de probabilidad guardadas en: resultados/predicciones_probabilidad_Compe_02_V1_1z_varias_seeds_2025-11-12_03-17-00.csv
2025-11-12 03:17:00,356 - INFO - src.final_training_p 335 - Predicciones generadas:
2025-11-12 03:17:00,356 - INFO - src.final_training_p 336 -   Total clientes: 164,313
2025-11-12 03:17:00,356 - INFO - src.final_training_p 337 -   Predicciones positivas: 13,298 (8.09%)
2025-11-12 03:17:00,356 - INFO - src.final_training_p 338 -   Predicciones negativas: 151,015
2025-11-12 03:17:00,356 - INFO - src.final_training_p 339 -   Porcentaje solicitado: 0.0809
2025-11-12 03:17:00,356 - INFO - __main__ 140 - Guardar predicciones
2025-11-12 03:17:00,368 - INFO - src.output_manager_p 51 - Predicciones guardadas en: predict/Compe_02_V1_1z_20251112_031700.csv
2025-11-12 03:17:00,368 - INFO - src.output_manager_p 52 - Formato del archivo:
2025-11-12 03:17:00,368 - INFO - src.output_manager_p 53 -   Columnas: ['numero_de_cliente', 'predict']
2025-11-12 03:17:00,368 - INFO - src.output_manager_p 54 -   Registros: 164,313
2025-11-12 03:17:00,368 - INFO - src.output_manager_p 55 -   Primeras filas:
2025-11-12 03:17:00,368 - INFO - src.output_manager_p 57 - 
shape: (5, 2)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ numero_de_cliente ‚îÜ predict ‚îÇ
‚îÇ ---               ‚îÜ ---     ‚îÇ
‚îÇ i64               ‚îÜ i64     ‚îÇ
‚ïû‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï™‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï°
‚îÇ 249797738         ‚îÜ 0       ‚îÇ
‚îÇ 249986329         ‚îÜ 0       ‚îÇ
‚îÇ 250175946         ‚îÜ 0       ‚îÇ
‚îÇ 250379482         ‚îÜ 0       ‚îÇ
‚îÇ 250585571         ‚îÜ 0       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
2025-11-12 03:17:00,368 - INFO - __main__ 144 - === RESUMEN FINAL ===
2025-11-12 03:17:00,368 - INFO - __main__ 145 - ‚úÖ Entrenamiento final completado exitosamente
2025-11-12 03:17:00,368 - INFO - __main__ 146 - üìä Mejores hiperpar√°metros utilizados: {'num_iterations': 791, 'num_leaves': 32, 'learning_rate': 0.06042022439783674, 'feature_fraction': 0.9211775896580184, 'min_child_samples': 15, 'max_depth': 6, 'reg_lambda': 8.61923640022853, 'reg_alpha': 7.350609321509172, 'min_gain_to_split': 0.5404345907464742, 'bagging_freq': 1, 'objective': 'binary', 'metric': 'None', 'random_state': 666557}
2025-11-12 03:17:00,368 - INFO - __main__ 147 - üéØ Per√≠odos de entrenamiento: ['201901', '201902', '201903', '201904', '201905', '201906', '201907', '201908', '201909', '201910', '201911', '201912', '202001', '202002', '202011', '202012', '202101', '202102']
2025-11-12 03:17:00,369 - INFO - __main__ 148 - üîÆ Per√≠odo de predicci√≥n: 202106
2025-11-12 03:17:00,369 - INFO - __main__ 151 - üìÅ Archivo de salida: predict/Compe_02_V1_1z_20251112_031700.csv
2025-11-12 03:17:00,369 - INFO - __main__ 152 - üìù Log detallado: /home/guijomter/buckets/b1/Compe_02/logs/log_Compe_02_V1_1z_2025-11-12_03-13-09.log
2025-11-12 03:17:00,369 - INFO - __main__ 155 - >>> Ejecuci√≥n finalizada. Revisar logs para mas detalles.
2025-11-12 03:17:00,451 - INFO - __main__ 164 - Ejecuci√≥n finalizada.
